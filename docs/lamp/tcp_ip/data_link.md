# 数据链路

## 3.1 数据链路的作用
  数据链路，指ISO参考模型中的数据链路层，有时也指以太网、无线局域网等通信手段。
  
  TCP/IP中对于OSI参考模型的数据链路层及以下部分(物理层)未做定义。因为TCP/IP以这两层的功能是透明的为前提。然而，数据链路层的知识对于深入理解TCP/IP与网络起着至关重要的作用。
  
  数据链路层的协议定义了通过通信媒介互联的设备之间的传输规范。 通信媒介包括双胶电缆、同轴电缆、光纤、电波以及红外线等介质。此外，各个设备之间有时也会通过交换机、网桥、中继器等中转数据。
  
  实际上，各个设备之间在数据传输时，数据链路层和物理层都是必不可少的。众所周知，计算机以0、1来表示信息，然而实际的通信媒介之间处理的确实电压的高低、光的闪灭以及电波的强弱等信号。把这些信号与二进制的0、1进行转换正是物理层的责任。数据链路层处理的数据也不是单纯的0、1序列，该层把它们集合为一个叫做帧的块，然后再进行传输。
  
  本章旨在介绍OSI参考模型中数据链路层的相关技术，包括MAC寻址(物理寻址)、介质共享、非公有网络、分组交换、环路检测、VLAN等。本章也会涉及作为传输方式的数据链路，比如以太网、WLAN、PPP(point to piont协议)等概念。数据链路也可以被视为网络传输中的最小单位。其实，仔细观察联通全世界的互联网就可以发现，它也不外乎是由众多这样的数据链路组成的，因此又可以称互联网为"数据链路的集合".
  
  在以太网与FDDI(Fiber Distributed Data Interface)的规范中，不仅包含OSI参考模型的第二层数据链路层，也规定了第一层物理层的规范。而在ATM(Asynchronous Transfer Mode异步传输方式)的规范中，还包含了第三层的一部分功能。
  
```
  数据链路层的段
  数据链路层的段是指一个被分割的网格。然而根据使用者不同，其含义也不尽相同。例如，引入中继器将两条网线相连组成一个网络。
  
  这种情况下有两条数据链路:
  1. 从网络层的概念看，他是一个网络(逻辑上) --> 即，从网络层的立场出发，这两条网线组成一个段。
  2. 从物理层的概念看，两条网线分别是两个物体(物理上) --> 即，从物理层的观点出发，一条网线是一个段。
```

## 3.2 数据链路相关技术

### 3.2.1 MAC地址
  MAC地址用于识别数据链路中互联的两个节点。以太网或FDDI中，根据IEEE802.3的规范使用MAC地址。其他诸如无线LAN(IEEE802.11a/b/g/n等)、蓝牙等设备中也是使用相同规格的MAC地址。
  
  MAC地址长48比特，结构如下。在使用网卡NIC的情况下，MAC地址一般都会被烧入ROM中。因此，任何一个网卡的MAC地址都是唯一的，在全世界都不会重复。
```
_1 2 3                       24|25                                  48|
+-+-+------------~-------------+------------------~-------------------+
| | |      厂商识别码          |          厂商内识别码                |
+-+-+------------~-------------+------------------~-------------------+

第一位: 单播地址0/多播地址1
第二位: 全局地址0/本地地址1
第3～24位: 由IEEE管理并保证各个厂家之间不重复。
第25～48位: 由厂商管理并保证产品之间不重复。
```

### 3.2.2 共享介质型网络
  从通信介质(通信，介质)的使用方法上看，网络可以分为共享介质型和非共享介质型。
  
  共享介质型网络指多个设备共享一个通信介质的一种网络。最早的以太网和FDDI就是共享介质型网络。 在这种方式下，设备之间使用同一个载波信道进行发送和接收。为此，基本上采用半双工通信的方式，并有必要对介质进行访问控制。
  
  共享介质型网络中有两种介质访问控制方式: 一种是争用方式，一种是令牌传递方式。
  
#### 争用方式(contention)
  争用方式是指争夺获取数据传输的权力，也叫CSMA(载波监听多路访问)。这种方式通常令网络中的各个站采用先到先得的方式占用信道发送数据，如果多个站同时发送帧，则会产生冲突现象。也因此会导致网络拥堵与性能下降。
  
```
_                     ..................................
_                     ^                                V
1.     A              B                C               D
_      +              +                +               +
_      |              |                |               |
||-----+--------------+----------------+---------------+--------||
_       B确认没有其他设备在发送数据以后

2.     A              B                C               D
_      +              +                +               +
_      |              |                |               |
||-----+--------------+----------------+---------------+--------||
_      ^              V                ^               ^
_      |              |                |               |
_      +--------------+----------------+---------------+
_            立即发送数据给D


3.     A              B                C               D
_      +              +                +               +
_      |              |                |               |
||-----+--------------+----------------+---------------+--------||
_      ^ x            V              x ^             o ^
_      |              |                |               |
_     每个站从报文首部中读取接收端MAC地址，若跟自己的不匹配则丢弃
```

  B想要发送数据给D, 需要如下操作：
  1. B确认没有其他设备载发送数据
  2. 立即发送数据给D
  3. 每个站从报文首部中国年读取接收端MAC地址，若跟自己的不匹配则丢弃

  在一部分以太网当中，采用了改良的CSMA的令一种方式---CSMA/CD方式。CSMA/CD要求每个站提前检查冲突，一旦发生冲突，则尽早释放信道。其具体工作原理如下:
  * 如果载波信道上没有数据流动，则任何站都可以发送数据
  * 检查是否会发生冲突。一旦发生冲突时，放弃发送数据，同时立即释放载波信道。
  * 放弃发送以后，随即延时一段时间，再重新争用介质，重新发送帧。

#### 令牌传递方式
  令牌传递方式时沿着令牌环发送一种叫做令牌的特殊报文，是控制传输的一种方式。只有获得令牌的站才能发送数据。这种方式有两个特点：一是不会有冲突，二是每个站都有通过平等循环获得令牌的机会。因此，即使网络拥堵也不会导致性能下降。
  
  当然，这种方式中，一个站再没有收到令牌前不能发送数据帧，因此再网络不太拥挤的情况下，数据链路的利用率也就达不到100%。为此，衍生了多种令牌传递的技术。例如，早期令牌释放、令牌追加等方式以及多个令牌同时循环等方式。这些方式的目的都是为了可能的提高网络性能。
  
### 3.2.3 非共享介质网络
  非共享介质网络是指不共享介质，是对介质采用专用的一种传输控制方式，在这种方式下，网络中的每个站直连交换机，由交换机负责转发数据帧。此方式下，发送端和接收端并不共享通信介质，因此很多情况下采用全双工通信方式。
