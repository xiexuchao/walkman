## 第9章 假设检验(Hypothesis Tests)

  在第7、8章我们展示了样本是如何用于开发总体参数的点估计和区间估计。 这一章我们继续统计推断的讨论， 通过展示假设检验如何用于确定关于总体参数值的陈述应该被接受还是被拒绝。
  
  在假设检验中，我们开始的时候对总体进行一个初步假设。 这个初步假设称为原假设(null hypothesis), 用H<sub>0</sub>表示。 然后我们定义另外一个假设， 叫做对立假设(alternative hypothesis), 也就是我们在原假设中的相反陈述。对立假设用H<sub>a</sub>表示。假设检验过程就是使用样本中的数据来测试由H<sub>0</sub>和H<sub>a</sub>所代表的互相矛盾的陈述。
  
  本章展示如何对总体均值和总体比例假设检验的。我们开始提供一些例子来演示提出原假设和对立假设的方法。
  
### 原假设和对立假设提法
  制定原假设和对立假设并不总是显而易见的。 必须仔细构建合适的假设，那样测试结论才能为研究者和决策制定者提供需要的信息。情景的上下文在决定假设应该如何开始是非常重要的。所有的假设检验应用程序都涉及抽样以及使用样本结果提供证据得出结论。在制定原假设和对立假设的时候要考虑的问题有:抽样的目的是什么? 我们希望作出什么样的结论。
  
  在本章简介中，我们使用H<sub>0</sub>作为关于总体参数的试探性假设， 例如总体均值或者总体比例。 对立假设H<sub>a</sub>是原假设所陈述的对立面。 在其他情况下，很容易标示原假设，然后提出对立假设。 我们将在下面的例子中演示这些情况。
  
  对立假设作为研究假设
  很多假设检验的应用涉及到为支持研究假设而搜集证据。这些情况下，通常最好从对立假设开始， 然后作出研究者希望支持的证据。考虑这样一个例子，某品牌汽车当前汽油使用效率是24英里/加仑， 产品研发组开发了一种新的燃油喷射系统来增加每加仑英里的使用效率。 该组将进行控制测试来看统计是否支持这个结论， 新的燃油喷射系统比当前系统提供更高的使用效率。
  
  该集团将使用新的燃油喷射系统运行控制测试，寻找统计支持结论，看新的燃油喷射系统是否比当前系统提供更多使用效率。
  
  会生产一些使用新燃油喷射系统的单元， 安装到测试汽车上，然后针对研究控制驱动条件。 这些汽车的样本均值将被计算，用于假设检验，来确定是否能总结出新的系统提供更多的使用效率，比24英里/加仑要多。 总体均值的术语使用μ， 研究假设μ>24称为对立假设。 既然当前系统提供了平均使用效率小于24，使用μ≤24. 我们将μ≤24作为原假设。 那么原假设和对立假设如下:
  H<sub>0</sub>: μ≤24
  H<sub>a</sub>: μ>24
  
  如果样本结果导致结论拒绝H<sub>0</sub>,那么可以作出推断，H<sub>a</sub>: μ>24成立。 研究者统计支持新系统具有较高使用效率的陈述。 使用新系统生产值得考虑。 然而，如果，样本结果导致结论H<sub>a</sub>被拒绝的话，那么研究者不能总结出新系统具有更高的使用效率。使用新系统生产可能不会被满足。 也许还需要更多的研究以及进行深入的测试。
  
  成功的公司都是在当前可用产品基础上开发新产品、新方法、新系统以及类似的，来保持竞争力。 在采取新的方案之前， 需要进行研究并确定是否满足新的方案确实好的支持结论。这些情况下，研究假设都是作为对立假设开始的。 例如，新的教育方法被开发，相信比当前方法好。 对立假设是新方法比较好。 新的销售奖金计划被开发为了试图增加销售。 原假设是新的奖金方案没有当前的好。 新的药物被开发出来具有比当前降压效果好。那么对立假设是新药物比当前药物具有降压效果好。原假设是新药物不比当前药物降压效果好。 在这些例子中，拒绝原假设提供了对研究假设的支持。 我们将看到很多在研究情况下的假设测试例子。
  
  原假设作为被质疑的假设
  当然，并不是所有假设测试涉及研究假设。 在下面的讨论我们考虑假设测试应用，


  显著性水平: level of significance 
  显著性水平是当原假设作为等式为真时造成类型I错误的概率。
  
  实践中，负责假设检验的人指定显著性水平。 通过选择一个α，检验人控制造成类型I错误的概率。 如果造成类型I错误的代价很高， 选择较小的α值。 如果造成类型I的错误代价不太高， 一般使用稍微大一点的α值。 假设检测应用仅仅控制类型I错误叫做显著性检验(significance tests). 很多假设测试应用都是这种类型。
  
  虽然大多数假设检测应用控制造成类型I错误的概率， 不总控制造成类型II的错误。 因此，如果我们决定接受H<sub>0</sub>， 我们不能决定我们可以使用那个决策的把握有多少。因为不确定在执行显著性检测时造成的类型II相关错误， 统计者通常推荐我们使用这样的陈述:"不拒绝H0", 而不使用“接受H0”. 使用不拒绝H0，带有同时抑制判断和行为的建议。 效果上来说，不直接接受H0, 统计者避免了冒类型II错误的风险。不论什么时候造成类型II错误的概率不能确定或控制， 那么我们就不做出接受H0的陈述。 在这些例子中， 只有两种可能结论: 不拒绝H0或者拒绝H0.
  
  虽然在假设检验中控制类型II错误不常见， 但还是可以这样做的。 如果已经确定了这种错误的恰当控制， 基于接受H0的行为总结可以更加恰当。
  
  注意: 威廉姆斯指出在决策制定过程中， 类型I和类型II错误都是同时存在的。 不管决策如何制定， 造成代价高的错误概率都不能消除。
  
### 9.3 总体均值: σ已知
  在第8章中，我们说到σ已知情况相应于那些应用，它们的历史数据和/或其他信息可用于让我们获得对总体标准方差比从样本得到具有较好估计。 这种情况下， 对所有实践目的， 总体标准方差可以视为已知。本节，我们展示如何在σ已知的情况下对总体均值进行假设检验。
  
  本节出现的方法要求样本是从服从正态分布的总体中获取的。 在那些没有理由假设总体是正态分布的情况下， 如果抽样大小足够大这些方法依然适用。 我们在本节结束提供一些关于总体分布以及样本尺寸的实践建议。
  
  单侧检验(One-Tailed Test) 单尾检测
  关于总体均值的单侧检验具有下面的两种形式:
  左尾检测(Lower Tail Test): H0: μ ≥ μ0 Ha: μ < μ0
  右尾检测(Upper Tail Test): H0: μ ≤ μ0 Ha: μ > μ0
  
  下面让我们看一个左尾检测的例子。
  
  联邦贸易委员会(FTC)定期进行统计研究设计来检测生产商关于产品作出的声明。 例如，山顶咖啡大罐标签上说明它能装3磅咖啡。 FTC知道山顶咖啡生产过程不可能每罐都完全装3磅咖啡， 即使所有罐总体的均值可能会达到每罐3磅咖啡。 然而， 只要总体均值至少3磅每罐， 那么消费者权益就能得到保障。 因此，FTC将山顶咖啡大罐标签上面的声明解释为总体平均装入每个大罐的咖啡至少为3磅。 我们将会看到FTC是如何对山顶咖啡的声明进行左尾假设检测检查的。
  
  第一步， 提出检测的原假设和备则假设。如果总体平均每罐至少装入3磅咖啡， 那么山顶咖啡的声明正确。 这就确定了检测的原假设。 然而， 如果总体均值重量小于3磅/罐， 这就确定了检测的备则假设。 使用μ标示总体平均每罐重量， 那么原假设和备则假设如下:
  H<sub>0</sub>: μ≥3
  H<sub>a</sub>: μ<3
  
  注意，总体均值的假设值为μ<sub>0</sub>=3. 
  
  如果样本数据表明H0不能被拒绝， 统计证据不足以支持标签违规的结论。 因此，不需要对山顶咖啡采取任何行为。 然而，如果样本数据表明H0能被拒绝， 那么我们将总结出备则假设成立。 这种情况， 总结山顶咖啡标签违规，所盛咖啡不满， 控告它是合理的。
  
  假如36罐咖啡样本被抽样， 样本均值计算并估计总体均值μ. 如果样本均值x̄比3小，样本结果将对原假设产生质疑。
  
  我们想要知道其中多少x̄必须小于3磅，在我们即将声明显著性差异以及冒造成类型I错误的风险，以至于作出对山顶咖啡标签违规的诬告。 
  定位这种问题的关键因素在于决策制定者选择的显著性级别的值。
  
  正如前一节所说明的，显著性级别使用α表示， 是当原假设在使用等式的时候为真拒绝H0的类型I错误的概率。决策制定者必须指定显著性级别。如果产生类型I错误的代价比较高，应该选择一个相对较小的显著性水平值。 如果代价不高，可以选择稍微大点的值。在山顶咖啡的案例中，FTC的检验执行官作出如下陈述:"如果公司满足重量规格μ=3, 我不想对它们采取行动。 但是，我可能会有1%的机会造成这样的错误"。 从执行官的陈述，我们可以设置这个假设检验的显著性级别α＝0.01. 因此，我们必须设计假设检验，以便使得当μ=3时产生错误类型I的概率为0.01. 
  
  对于山顶咖啡案例， 通过指定原假设、备则假设以及指定检验的显著性级别， 我们执行每个假设检验所必须进行的前两步。 现在我们做好执行假设检验第三步的准备: 抽样数据并计算所谓的检验统计量的值。
  检验统计量(Test Statistic) 对山顶咖啡来说， 之前FTC检验显示总体标准方差可以假设已知，值为σ=0.18. 另外， 这些检验也展示总体填充重量可以假设具有正态分布。 从第七章的样本分布学习，我们知道如果抽样总体是正态分布的，那么样本均值的分布也是正态的。因此，对于山顶咖啡案例， 样本均值分布也是正态分布的。 并且σ=0.18,已知， 样本的尺寸为36，图9.1展示样本均值在原假设作为等式的情况下为真的分布情况。 也就是在μ=μ<sub>0</sub>=3。注意样本均值的标准误差可以由σ/√n计算，=0.18/√36=0.03
  
  因为样本均值x̄分布是正态分布， 样本分布
  z = (x̄-μ<sub>0</sub>)/σ<sub>x̄</sub>=(x̄-3)/0.03
  
  ![](https://github.com/walkerqiao/walkman/blob/master/images/da/sfbe_9.1.png)
  
  对关于总体均值在总体方差已知的情况下的假设检验，我们使用标准随机变量z作为检验测试量来决定样本均值是否与样本均值μ的偏差是否足够大证明拒绝原假设。
  
  对于左尾检验来说，关键的问题在于，我们选择拒绝原假设之前，检验测试量z应该多小? 有两种方法可以用来回答这个问题: 
  * p值方法(p-value approach)
  * 临界值方法(critical value approach)

  p值方法: p值方法使用检验测试量z来计算叫做p值的概率。
  
  p值: p值是一种概率，提供对反对由样本提供的原假设的证据度量。p值越小表明对H<sub>0</sub>的拒绝的证据就更加有力。
  
  p值意义:
  1. 一种概率， 是在原假设为真的情况下， 出现样本以及极端情况的概率。
  2. 拒绝原假设的最小显著性水平
  3. 观察到的(实例的)显著性水平
  4. 表示对原假设的支持程度， 是用于确定是否拒绝原假设的另一种方法。
  
  举例来说， 假设某工厂正在生产一批50g的砝码， 结果生产了一批， 最后用统计方法测量的均值为47.6g, 标准差为20，而算出的pvalue只有3%, 那么意味着出现了小概率事件， 比如机器有小故障、技术人员玩忽职守、昼夜温差大影响工人心情，但以上发生的概率只有区区的0.03；或者你原本生产的就不是50g的砝码；
  那么你愿意相信哪种情况呢?
  如果p值较大，那么，还没有足够的证据证明可以拒绝原假设，并不是一个积极的态度接受原假设,这个说法要从原假设和对立假设的确立说起,这两个假设的地位根本不是平等的.
  
  p值用于确定是否应该拒绝原假设。

  下面我们看看p值如何计算以及使用的。 检验统计量的值用于计算p值。 使用的方法依赖于检验是左尾检验、右尾检验还是双尾检验。 对于左尾检验来说，p值是获取尽可能比样本提供的检验统计量小的检验统计量的值的概率。因此，要计算在σ已知的情况下，左尾检验的p值，我们必须查找在正态曲线下面z≤检测统计量的面积。 在计算p值之后，我们然后决定它是否足够小来拒绝原假设； 正如我们将要展示的， 这个决定涉及到p值和显著性水平的比较。
  
  下图是相应pvalue的计算
  ![](https://github.com/walkerqiao/walkman/blob/master/images/da/sfbe_pvalue_cal.png)

  p值为0.038, 这个p值表明了获取样本均值为2.92(或检验统计量为-2.67)的时候概率较小，或者说当从具有总体均值为3的总体取样时pvalue很小。
  
  但是p值不对原假设的支持提供更多信息， 但是是否它足够小就能导致我们拒绝原假设呢? 答案就是， 要看这个p值和显著性水平的关系了。
  
  正如前面所示， FTC检验程序选择了显著性水平为0.01。 也就是α=0.01, 意思是执行者希望容忍0.01的概率拒绝原假设，当它作为等式的时候为真。 pvalue比α还要小， 这就证明， 有足够的证据让我们拒绝原假设。
  
  下面我们陈述确定使用pvalue是否可以拒绝原假设的一般规则。 对于显著性水平α, 使用p值方法拒绝规则如下:
  如果p值≤α 拒绝H<sub>0</sub>
  
  p值也叫观测的显著性水平(observed level of significance)
  
  不同的决策制定者对造成类型I错误的成本表达不同的选择， 可能选择不同的显著性水平。 通过提供假设检验结果的p值， 另外的决策制定者可能比较他自己的显著性水平，可能作出的对原假设的拒绝与否的决定也是不同的。
  
  临界值方法(critical value approach) 临界值方法需要我们首先为检验统计量决定一个值叫做临界值。 对于左尾检验来说， 临界值作为一个基准，用于决定检验统计量是否足够小，可以拒绝原假设。 
  临界值就是检验统计量在相应左尾检验样本检验统计量分布α的面积。
  换句话说，临界值就是结果支持拒绝原假设的最大检验统计量值。
  
  假设α = 0.01, 那么我们查表可以知道z为-2.33时标准正态分布左侧的面积接近0.01但不高于0.01. 也就是面积值最大且不超过α的z最大值是-2.33. 
  因此如果z≤-2.33时拒绝H<sub>0</sub>. 根据前面计算的z值是-2.67<-2.33, 因此，我们能拒绝H<sub>0</sub>. 
  
  使用临界值方法的图解
  ![](https://github.com/walkerqiao/walkman/blob/master/images/da/sfbe_critical_value_cal.png)
  
  ![](https://github.com/walkerqiao/walkman/blob/master/images/da/sfbe_critical_value_rule.png)

  使用p值方法和临界值方法都可以得到结论。 但是p值方法除了能够得到是否拒绝原假设，还能知道显著情况到底如何；而临界值只能获得给定的显著性条件下的显著情况。
  
  对于右尾检验来说， 基本思路一致。
  * p值≤α拒绝原假设
  * z≥z临界值 拒绝原假设
  
  对于双尾检验 H<sub>0</sub>: μ=μ<sub>0</sub>     H<sub>a</sub>: μ≠μ<sub>0</sub>
  * p值≤α拒绝原假设
  * z≤-z<sub>α/2</sub>或z≥z<sub>α/2</sub>拒绝原假设
  
  汇总表
  ![](https://github.com/walkerqiao/walkman/blob/master/images/da/sfbe_summary_reject_h0.png)

  
  总结及实践建议
  假设检验的步骤:
  p值方法
  1. 指出原假设和备则假设H<sub>0</sub>和H<sub>a</sub>
  2. 指定显著性水平α
  3. 抽样并计算检验统计量
  4. 使用检验统计量和计算的p值比较
  5. 如果p值≤α, 拒绝H<sub>0</sub>
  
  临界值法
  1. 指出原假设和备则假设H<sub>0</sub>和H<sub>a</sub>
  2. 指定显著性水平α
  3. 抽样并计算检验统计量
  4. 使用显著性水平来确定临界值和拒绝规则
  5. 使用检验统计量和拒绝规则来确定是否拒绝H<sub>0</sub>
  
  
  区间估计和假设检验的关系
  在第八章，我们展示了如何开发总体均值的置信区间估计。 对于σ已知， 总体均值的(1-α)%置信区间估计可以通过下面的方式计算得来:
  x̄±z<sub>α/2</sub>σ/√n
  
  在本章中，我们展示了总体均值的双尾假设检验形式如下:
  H<sub>0</sub>: μ = μ<sub>0</sub>      H<sub>a</sub>: μ ≠ μ<sub>0</sub>
  这里的μ<sub>0</sub>是总体均值的假设值。

  假设我们按照第八章中为总体均值构建100(1-α)%的置信区间的过程。
  我们知道100(1-α)%的置信区间一般会包含总体均值和100α%的置信区间一般不会包含总体均值。
  
  
