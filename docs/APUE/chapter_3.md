## 第三章 文件I/O

### 3.1 引言
  本章开始讨论Unix系统,先说明可用的文件I/O函数--打开文件、读文件、写文件等等。大多数Unix文件I/O只需用到5个函数:open, read, write, lseek以及close。然后说明不同缓存器长度对read和write函数的影响。
  本章所说明的函数经常被称之为不带缓存的I/O(unbuffered I/O, 与将在第5章中说明的标准I/O函数相对照)。术语--不带缓存指的是每个read和write都调用内核中的一个系统调用. 这些不带缓存的I/O函数不是ANSI C的组成部分,但是是POSIX.1和XPG3的组成部分。
  只要涉及在多个进程间共享资源,原子操作的概念就变成非常重要。我们将通过文件I/O和传送给open函数的参数来讨论此概念。并进一步讨 论在多个进程间如何共享文件,并涉及内核的有关数据结构。在讨论了这些特征后,将说明dup、fcntl和ioctl函数。

### 3.2 文件描述符
  对于内核而言,所有打开文件都由文件描述符引用。文件描述符是一个非负整数。当打开 一个现存文件或创建一个新文件时,内核向进程返回一个文件描述符。当读、写一个文件时, 用 o p e n或 c r e a t返 回 的 文 件 描 述 符 标 识 该 文 件 , 将 其 作 为 参 数 传 送 给 r e a d 或 w r i t e。
按照惯例,UNIX shell使文件描述符0与进程的标准输入相结合,文件描述符 1与标准输出 相结合,文件描述符 2与标准出错输出相结合。这是 UNIX shell以及很多应用程序使用的惯例, 而与内核无关。尽管如此,如果不遵照这种惯例,那么很多 U N I X应 用 程 序 就 不 能 工 作 。
在P O S I X . 1 应用程序中,幻数 0 、1 、 2 应被代换成符号常数 S T D I N _ F I L E N O、 S T D O U T _ F I L E N O 和 S T D E R R _ F I L E N O。这些常数都定义在头文件 < u n i s t d . h > 中。
文 件 描 述 符 的 范 围 是 0 ~ O P E N _ M A X (见表 2 - 7 ) 。早期的 U N I X 版 本 采 用 的 上 限 值 是 1 9 ( 允许 每个进程打开 2 0个文件 ) ,现在很多系统则将其增加至 6 3。
### 3.3 open和openat函数

### 3.4 creat函数

### 3.5 close函数

### 3.6 lseek函数

### 3.7 read函数

### 3.8 write函数

### 3.9 I/O效率

### 3.10 文件共享

### 3.11 原子操作

### 3.12 dup和dup2函数

### 3.13 sync, fsync和fdatasync函数

### 3.14 fcntl函数

### 3.15 ioctl函数

### 3.16 /dev/fd

### 3.17 总结
