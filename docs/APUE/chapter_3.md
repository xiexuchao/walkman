## 第三章 文件I/O

### 3.1 引言
  本章开始讨论Unix系统,先说明可用的文件I/O函数--打开文件、读文件、写文件等等。大多数Unix文件I/O只需用到5个函数:open, read, write, lseek以及close。然后说明不同缓存器长度对read和write函数的影响。
  本章所说明的函数经常被称之为不带缓存的I/O(unbuffered I/O, 与将在第5章中说明的标准I/O函数相对照)。术语--不带缓存指的是每个read和write都调用内核中的一个系统调用. 这些不带缓存的I/O函数不是ANSI C的组成部分,但是是POSIX.1和XPG3的组成部分。
  只要涉及在多个进程间共享资源,原子操作的概念就变成非常重要。我们将通过文件I/O和传送给open函数的参数来讨论此概念。并进一步讨 论在多个进程间如何共享文件,并涉及内核的有关数据结构。在讨论了这些特征后,将说明dup、fcntl和ioctl函数。

### 3.2 文件描述符
  对于内核而言,所有打开文件都由文件描述符引用。文件描述符是一个非负整数。当打开一个现存文件或创建一个新文件时,内核向进程返回一个文件描述符。当读、写一个文件时, 用open或creat返回的文件描述符标识该文件,将其作为参数传送给read或write.
  按照惯例,UNIX shell使文件描述符0与进程的标准输入相结合,文件描述符1与标准输出相结合,文件描述符2与标准出错输出相结合。这是UNIX shell以及很多应用程序使用的惯例, 而与内核无关。尽管如此,如果不遵照这种惯例,那么很多Unix应用程序就不能工作。
  在POSIX.1应用程序中,幻数0、1、2应被代换成符号常数STDIN_FILENO、STDOUT_FILENO和STDERR_FILENO。这些常数都定义在头文件<unistd.h>中。
  文件描述符的范围是0~OPEN_MAX(见表2-7)。早期的Unix版本采用的上限值是19(允许每个进程打开20个文件),现在很多系统则将其增加至63。
  
### 3.3 open和openat函数

### 3.4 creat函数

### 3.5 close函数

### 3.6 lseek函数

### 3.7 read函数

### 3.8 write函数

### 3.9 I/O效率

### 3.10 文件共享

### 3.11 原子操作

### 3.12 dup和dup2函数

### 3.13 sync, fsync和fdatasync函数

### 3.14 fcntl函数

### 3.15 ioctl函数

### 3.16 /dev/fd

### 3.17 总结
